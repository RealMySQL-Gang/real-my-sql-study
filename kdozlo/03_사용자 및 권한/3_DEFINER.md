# DEFINER

### 정의
- 데이터베이스 객체(뷰, 저장 프로시저, 함수, 트리거, 이벤트 등)를 생성할 때, 해당 객체가 실행될 때 사용할 기본 사용자 계정을 지정하는 역할을 합니다.
- 이때, DEFINER가 설정된 객체는 호출하는 사용자와 관계없이, 미리 정의된 계정의 권한으로 실행됩니다.

### 특징
- **ad-hoc 쿼리에는 `DEFINER` 설정을 적용할 수 없음**
    - **ad-hoc 쿼리란?**  
      데이터베이스에 저장되지 않고, 사용자가 필요할 때 즉석에서 작성하여 실행하는 SQL문을 말합니다.  
      예: 직접 입력하는 `SELECT`, `UPDATE`, `INSERT` 등
- **안전한 권한 실행**  
  민감한 데이터에 접근하거나 특정 작업을 수행할 때, 권한이 제한된 사용자가 객체를 호출해도 미리 정의된 계정의 권한으로 **안전하게** 실행됩니다.
- **일관된 실행 권한**  
  DEFINER에 명시된 계정의 권한으로 해당 객체가 실행되므로, 호출하는 사용자의 권한과 무관하게 항상 동일한 권한 컨텍스트에서 동작합니다.

### 고려사항
- **보안 측면**  
  잘못된 DEFINER 설정은 호출자가 본인의 권한보다 높은 권한으로 데이터에 접근할 수 있는 보안 위험을 초래할 수 있으므로, 설정 시 주의가 필요합니다.
- **마이그레이션 이슈**  
  데이터베이스를 이전하거나 복제할 때, DEFINER에 설정된 계정이 존재하지 않으면 문제가 발생할 수 있으므로, 계정 관리에 신경 써야 합니다.

### 예시1
- `main_proc()`라는 저장 프로시저가 있다고 가정합니다.
- `user1`과 `user2` 모두 `main_proc()` 실행 권한을 가지고 있습니다.
- 그러나, `main_proc()` 내부에서 호출되는 `sub_proc()`는 **user1**만 실행할 수 있는 권한을 가집니다.
    - 이 경우, `user2`가 `main_proc()`를 실행하면 내부에서 `sub_proc()`를 호출할 때 권한 부족 오류가 발생합니다.
- 이를 해결하기 위해, `main_proc()`에 `DEFINER`를 **user1**으로 지정하면:
    - `main_proc()`는 항상 **user1**의 권한으로 실행됩니다.
    - 따라서, `user2`가 `main_proc()`를 호출해도 내부적으로 **user1**의 권한으로 `sub_proc()`가 실행되어 오류가 발생하지 않습니다.
    - 즉, `user2`는 직접 `sub_proc()`를 실행할 수 없지만, `main_proc()`를 통해 간접적으로 `sub_proc()`를 실행할 수 있게 됩니다.

### 예시2
- 원본 테이블 `employee_details`에 민감한 정보(예: 주민등록번호, 급여 등)와 공개 가능한 정보(예: 이름, 부서 등)가 모두 저장되어 있다고 가정합니다.
- 사용자에게는 민감한 정보는 노출하지 않고, 일부 정보만 제공해야 하는 경우, 뷰(View)를 사용해 제한된 컬럼만 조회할 수 있도록 할 수 있습니다.
- 이 때, 뷰에 `DEFINER`를 지정하면, 호출하는 사용자의 권한과 상관없이 DEFINER로 지정된 계정의 권한으로 뷰가 실행되므로, 보안이 유지됩니다.

예시 코드:
```sql
-- (관리자 계정으로 실행) employee_details 테이블 생성
CREATE TABLE employee_details (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    department VARCHAR(50),
    ssn VARCHAR(20),         -- 민감 정보
    salary DECIMAL(10,2)     -- 민감 정보
);

-- (관리자 계정으로 실행) 민감한 정보는 제외하고, 공개 정보만 조회하는 뷰 생성
CREATE DEFINER=`security_admin`@`localhost` VIEW public_employee_view AS
SELECT employee_id, name, department
FROM employee_details;
```
